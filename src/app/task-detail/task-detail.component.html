<div class="task-detail-modal" *ngIf="task">
  <div class="modal-content">
    <!-- Sağ üst köşede kapatma ikonu -->
    <button class="close-button" (click)="close()">×</button>

    <h2>{{ task.title }}</h2>
    <p><strong>Açıklama:</strong> {{ task.description }}</p>
    <p><strong>Öncelik:</strong> {{ task.priority }}</p>
    <p><strong>Durum:</strong> {{ task.status }}</p>
    <p><strong>Oluşturan Kişi:</strong> {{ task.username }}</p>
    <p><strong>Atanan Kişi:</strong> {{ task.assigneeUsername || 'Atanmamış' }}</p>

    <!-- Atanan kişiyi değiştirme -->
    <div class="assignee-section">
      <label for="assigneeSelect">Atanan Kişiyi Değiştir:</label>
      <select id="assigneeSelect" [(ngModel)]="selectedAssignee" name="assigneeSelect">
        <option value="">Atanmamış</option>
        <option *ngFor="let user of projectUsers" [value]="user.username">{{ user.username }}</option>
      </select>
      <button (click)="updateAssignee()">Güncelle</button>
    </div>

    <!-- Yorum ekleme alanı -->
    <div class="comment-section">
      <h3>Yorum Ekle</h3>
      <textarea [(ngModel)]="newComment" placeholder="Yorumunuzu yazın..."></textarea>
      <button (click)="addComment()">Yorumu Gönder</button>
    </div>

    <!-- Mevcut yorumları listeleme -->
    <div class="comments-list" *ngIf="comments.length > 0">
      <h3>Yorumlar</h3>
      <div *ngFor="let comment of comments">
        <p><strong>{{ comment.username }}:</strong> {{ comment.content }}</p>
      </div>
    </div>
    <!-- Mevcut güncllemeleri listeleme -->
    <div class="task-history">
      <h3>Görev Geçmişi</h3>
      <div *ngIf="loadingHistory">Geçmiş yükleniyor...</div>
      <div *ngIf="errorLoadingHistory">Geçmiş yüklenirken bir hata oluştu.</div>
      <ul *ngIf="!loadingHistory && taskHistory.length > 0">
        <li *ngFor="let history of taskHistory">
          <p>
            <strong>{{ history.timestamp | date: 'short' }}:</strong>
            {{ history.fromAssignee || 'Atanmamış' }} → {{ history.toAssignee || 'Atanmamış' }}
            ({{ getHistoryDescription(history.changeType) }}, {{ history.changedBy }})
          </p>
        </li>
      </ul>
      <p *ngIf="!loadingHistory && taskHistory.length === 0">Henüz geçmiş yok.</p>
    </div>
</div>